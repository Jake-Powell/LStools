<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Creating sankey diagrams • LStools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating sankey diagrams">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">LStools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Creating_simple_reports.html">Creating simple reports</a></li>
    <li><a class="dropdown-item" href="../articles/creating_simple_tables.html">Creating simple tables</a></li>
    <li><a class="dropdown-item" href="../articles/Creating-Sankey-Diagrams.html">Creating sankey diagrams</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="Creating-Sankey-Diagrams_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="Creating-Sankey-Diagrams_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="Creating-Sankey-Diagrams_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="Creating-Sankey-Diagrams_files/datatables-binding-0.33/datatables.js"></script><link href="Creating-Sankey-Diagrams_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="Creating-Sankey-Diagrams_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="Creating-Sankey-Diagrams_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="Creating-Sankey-Diagrams_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="Creating-Sankey-Diagrams_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><script src="Creating-Sankey-Diagrams_files/d3-4.5.0/d3.min.js"></script><script src="Creating-Sankey-Diagrams_files/sankey-1/sankey.js"></script><script src="Creating-Sankey-Diagrams_files/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Creating sankey diagrams</h1>
            
      

      <div class="d-none name"><code>Creating-Sankey-Diagrams.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jakepowellcubg.github.io/LStools/">LStools</a></span><span class="op">)</span></span></code></pre></div>
<p><em>In this vignette we show how to use the LStools package to create
sankey diagrams of the educational pipeline</em></p>
<p>Firstly we need to create some data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">33</span><span class="op">)</span></span>
<span><span class="va">KS1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'3+'</span>,<span class="st">'2A'</span>,<span class="st">'2B'</span>, <span class="st">'2C-'</span><span class="op">)</span>, <span class="fl">10000</span>, replace <span class="op">=</span> <span class="cn">T</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.21</span>,<span class="fl">.28</span>,<span class="fl">.26</span>,<span class="fl">.25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">KS2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'6'</span>,<span class="st">'5+'</span>, <span class="st">'5-'</span>,<span class="st">'4'</span>,<span class="st">'3-'</span><span class="op">)</span>, <span class="fl">10000</span>, replace <span class="op">=</span> <span class="cn">T</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.15</span>, <span class="fl">0.22</span>, <span class="fl">0.46</span>, <span class="fl">0.13</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">GCSE</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'9'</span>,<span class="st">'8'</span>, <span class="st">'7'</span>, <span class="st">'6-'</span><span class="op">)</span>, <span class="fl">10000</span>, replace <span class="op">=</span> <span class="cn">T</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.07</span>, <span class="fl">0.10</span>, <span class="fl">0.80</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">A_level</span> <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Maths + Further'</span>,  <span class="st">'Maths'</span>, <span class="st">'No Maths'</span><span class="op">)</span>, <span class="fl">10000</span>, replace <span class="op">=</span> <span class="cn">T</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">0.09</span>, <span class="fl">0.89</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">FSM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Yes'</span>, <span class="st">'No'</span><span class="op">)</span>, <span class="fl">10000</span>, replace <span class="op">=</span> <span class="cn">T</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.238</span>, <span class="fl">1</span><span class="op">-</span><span class="fl">.238</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">IDACI</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1st'</span>,<span class="st">'2nd'</span>,<span class="st">'3rd'</span>, <span class="st">'4th'</span>, <span class="st">'5th'</span><span class="op">)</span>, <span class="fl">10000</span>, replace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="va">raw</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>FSM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">FSM</span><span class="op">)</span>,</span>
<span>                 IDACI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">IDACI</span><span class="op">)</span>,</span>
<span>                 KS1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">KS1</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'3+'</span>,<span class="st">'2A'</span>,<span class="st">'2B'</span>, <span class="st">'2C-'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 KS2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">KS2</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'6'</span>,<span class="st">'5+'</span>, <span class="st">'5-'</span>,<span class="st">'4'</span>,<span class="st">'3-'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 GCSE<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">GCSE</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'9'</span>,<span class="st">'8'</span>, <span class="st">'7'</span>, <span class="st">'6-'</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                 A_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">A_level</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Maths + Further'</span>,  <span class="st">'Maths'</span>, <span class="st">'No Maths'</span><span class="op">)</span><span class="op">)</span></span>
<span>                 <span class="op">)</span></span></code></pre></div>
<p>Within the data each row contains information about an individual
student, in our case whether they are classed as receiving free school
meals (FSM) or their IDACI quintile. Together with their maths grades at
KS1 (5 years old), KS2 (11 years old), GCSE (16 years old) and whether
they do maths at A-levels (18 years old). The students grades are
grouped at the various levels mirroring the proportion of students taken
from the maths pipeline report (figure XX). Note that the columns must
be cast by factor with the order in which you want the ‘nodes’ to appear
(i.e in our case highest level to lowest level).</p>
<p>We show the first 10 rows of the data below</p>
<p></p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:auto;"></div> <script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"filter":"none","vertical":false,"data":[["No","No","No","No","No","No","No","No","No","No"],["5th","5th","2nd","4th","1st","2nd","5th","2nd","5th","3rd"],["2B","2B","2B","3+","3+","2B","2B","2B","2A","2A"],["5-","5-","4","5-","3-","3-","4","4","5+","5+"],["6-","7","6-","6-","6-","6-","6-","6-","6-","6-"],["No Maths","No Maths","No Maths","No Maths","No Maths","No Maths","No Maths","No Maths","No Maths","No Maths"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>FSM<\/th>\n      <th>IDACI<\/th>\n      <th>KS1<\/th>\n      <th>KS2<\/th>\n      <th>GCSE<\/th>\n      <th>A_level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"dom":"tp","paging":false,"columnDefs":[{"name":"FSM","targets":0},{"name":"IDACI","targets":1},{"name":"KS1","targets":2},{"name":"KS2","targets":3},{"name":"GCSE","targets":4},{"name":"A_level","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>We want to be able to visualise the data via a sankey diagram from
KS1 to A-levels. The first step is to convert the individual student
data (contained in <code>raw</code>) to ‘pathways’, using the function
<code><a href="../reference/raw_to_pathway.html">raw_to_pathway()</a></code> which details the number of students who
have unique demographics and paths through the pipeline.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pathways</span> <span class="op">=</span> <span class="fu">LStools</span><span class="fu">::</span><span class="fu"><a href="../reference/raw_to_pathway.html">raw_to_pathway</a></span><span class="op">(</span><span class="va">raw</span><span class="op">)</span></span></code></pre></div>
<p>The first 10 rows of pathways are shown below</p>
<p></p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:100%;height:auto;"></div> <script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"filter":"none","vertical":false,"data":[["No","No","No","No","No","No","No","No","No","No"],["1st","1st","1st","1st","1st","1st","1st","1st","1st","1st"],["3+","3+","3+","3+","3+","3+","3+","3+","3+","3+"],["6","6","5+","5+","5+","5+","5+","5+","5+","5-"],["7","6-","8","8","7","7","6-","6-","6-","9"],["No Maths","No Maths","Maths","No Maths","Maths + Further","No Maths","Maths + Further","Maths","No Maths","Maths"],[1,5,1,3,2,1,1,6,37,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>FSM<\/th>\n      <th>IDACI<\/th>\n      <th>KS1<\/th>\n      <th>KS2<\/th>\n      <th>GCSE<\/th>\n      <th>A_level<\/th>\n      <th>No_students<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"dom":"tp","paging":false,"columnDefs":[{"className":"dt-right","targets":6},{"name":"FSM","targets":0},{"name":"IDACI","targets":1},{"name":"KS1","targets":2},{"name":"KS2","targets":3},{"name":"GCSE","targets":4},{"name":"A_level","targets":5},{"name":"No_students","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><div class="section level3">
<h3 id="creating-sankey-diagrams-directly-using-pathways">Creating sankey diagrams directly using pathways<a class="anchor" aria-label="anchor" href="#creating-sankey-diagrams-directly-using-pathways"></a>
</h3>
<p>We can then use <code><a href="../reference/sankey_filtered.html">sankey_filtered()</a></code> to convert the
pathways data frame into a sankey diagram.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="../reference/sankey_filtered.html">sankey_filtered</a></span><span class="op">(</span>pathways <span class="op">=</span> <span class="va">pathways</span>, flow_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, filters <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span></span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-36aa3d2a04d42bbc2145" style="width:960px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"links":{"source":[0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,9,10,11,12,9,10,11,12,9,10,11,12],"target":[4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15],"value":["58","83","74","74","317","415","409","353","460","608","661","561","992","1242","1241","1175","264","362","339","312","7","31","64","149","34","20","103","170","362","93","29","175","228","447","139","233","1185","1828","3692","1011","7","18","14","168","25","64","95","661","253","666","909","7120"]},"nodes":{"name":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","GCSE: 8","GCSE: 7","GCSE: 6-","A_level: Maths + Further","A_level: Maths","A_level: No Maths"],"group":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","GCSE: 8","GCSE: 7","GCSE: 6-","A_level: Maths + Further","A_level: Maths","A_level: No Maths"]},"options":{"NodeID":"names","NodeGroup":"names","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":0,"sinksRight":false}},"evals":[],"jsHooks":{"render":[{"code":"\n            function(el, x) {\n                d3.selectAll(\".node\").select(\"title foreignObject body pre\")\n                .text(function(d) { return d.state; });\n            }\n            ","data":null},{"code":"\n  function(el, x) {\n  d3.selectAll(\".link\").select(\"title foreignObject body pre\")\n  .text(function(d) { return d.name; });\n  }\n  ","data":null}]}}</script><p>Where the <code>flow_columns</code> specifies the columns used in
pathways for the sankey diagram in order. This can be specified either
with the column numbers (2 = KS1, 3 = KS2, etc) or via the columns names
<code>flow_columns = c('KS1', 'KS2', 'GCSE', 'A_level')</code>.</p>
<p>We can use the same function to explore subsections of the pipeline
by using the <code>filters</code> input.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Only those that have GCSE grade 9.</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="../reference/sankey_filtered.html">sankey_filtered</a></span><span class="op">(</span>pathways <span class="op">=</span> <span class="va">pathways</span>, flow_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, filters <span class="op">=</span> <span class="st">'GCSE: 9'</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-febe03efa1a2d8d52a86" style="width:960px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"links":{"source":[2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,4,5,6,7,8,9,9,9],"target":[4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,11,12],"value":["3","4","5","10","12","4","9","23","9","23","39","43","36","31","6","9","11","8","7","31","64","149","34","7","25","253"]},"nodes":{"name":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","A_level: Maths + Further","A_level: Maths","A_level: No Maths"],"group":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","A_level: Maths + Further","A_level: Maths","A_level: No Maths"]},"options":{"NodeID":"names","NodeGroup":"names","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":0,"sinksRight":false}},"evals":[],"jsHooks":{"render":[{"code":"\n            function(el, x) {\n                d3.selectAll(\".node\").select(\"title foreignObject body pre\")\n                .text(function(d) { return d.state; });\n            }\n            ","data":null},{"code":"\n  function(el, x) {\n  d3.selectAll(\".link\").select(\"title foreignObject body pre\")\n  .text(function(d) { return d.name; });\n  }\n  ","data":null}]}}</script><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Only those that have GCSE grade 9 and KS2 level 5+.</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="../reference/sankey_filtered.html">sankey_filtered</a></span><span class="op">(</span>pathways <span class="op">=</span> <span class="va">pathways</span>, flow_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'GCSE: 9'</span>, <span class="st">'KS2: 5+'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-1fb4450895fe099f74a1" style="width:960px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-1fb4450895fe099f74a1">{"x":{"links":{"source":[0,1,2,3,4,5,5,5],"target":[4,4,4,4,5,6,7,8],"value":["5","10","12","4","31","2","2","27"]},"nodes":{"name":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 5+","GCSE: 9","A_level: Maths + Further","A_level: Maths","A_level: No Maths"],"group":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 5+","GCSE: 9","A_level: Maths + Further","A_level: Maths","A_level: No Maths"]},"options":{"NodeID":"names","NodeGroup":"names","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":0,"sinksRight":false}},"evals":[],"jsHooks":{"render":[{"code":"\n            function(el, x) {\n                d3.selectAll(\".node\").select(\"title foreignObject body pre\")\n                .text(function(d) { return d.state; });\n            }\n            ","data":null},{"code":"\n  function(el, x) {\n  d3.selectAll(\".link\").select(\"title foreignObject body pre\")\n  .text(function(d) { return d.name; });\n  }\n  ","data":null}]}}</script><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Only those that have GCSE grade 9 or grade 8.</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="../reference/sankey_filtered.html">sankey_filtered</a></span><span class="op">(</span>pathways <span class="op">=</span> <span class="va">pathways</span>, flow_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'GCSE: 9'</span>, <span class="st">'GCSE: 8'</span><span class="op">)</span>, union <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-10b3b7155e8045a1b2ad" style="width:960px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-10b3b7155e8045a1b2ad">{"x":{"links":{"source":[0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,4,5,6,7,8,4,5,6,7,8,9,10,9,10,9,10],"target":[4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,12,12,13,13],"value":["4","2","11","10","20","44","43","27","45","70","58","61","114","134","132","131","27","37","38","25","7","31","64","149","34","20","103","170","362","93","7","18","25","64","253","666"]},"nodes":{"name":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","GCSE: 8","A_level: Maths + Further","A_level: Maths","A_level: No Maths"],"group":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","GCSE: 8","A_level: Maths + Further","A_level: Maths","A_level: No Maths"]},"options":{"NodeID":"names","NodeGroup":"names","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":0,"sinksRight":false}},"evals":[],"jsHooks":{"render":[{"code":"\n            function(el, x) {\n                d3.selectAll(\".node\").select(\"title foreignObject body pre\")\n                .text(function(d) { return d.state; });\n            }\n            ","data":null},{"code":"\n  function(el, x) {\n  d3.selectAll(\".link\").select(\"title foreignObject body pre\")\n  .text(function(d) { return d.name; });\n  }\n  ","data":null}]}}</script><p>Note that the <code>union</code> input only allows for looking at
flows through multiple nodes at a particular stage. I.e if you set
<code>union = T</code> in the example with KS2 level 5+ and GCSE grade 9
the output would be the same sankey diagram (rather than any student who
got KS2 level 5+ or GCSE grade 9).</p>
<p>As well as zooming into particular parts of the pipeline the filter
can also be used in relation to demographics as well.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Only those that have FSM status.</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="../reference/sankey_filtered.html">sankey_filtered</a></span><span class="op">(</span>pathways <span class="op">=</span> <span class="va">pathways</span>, flow_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, filters <span class="op">=</span> <span class="st">'FSM: Yes'</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-4018eef1a407a0df6b52" style="width:960px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-4018eef1a407a0df6b52">{"x":{"links":{"source":[0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,9,10,11,12,9,10,11,12,9,10,11,12],"target":[4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15],"value":["13","23","14","17","64","93","96","80","115","141","158","136","243","288","272","282","68","107","69","68","3","8","19","36","7","4","27","43","83","28","6","46","53","111","38","54","252","435","855","239","2","4","3","46","5","14","29","141","66","167","222","1648"]},"nodes":{"name":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","GCSE: 8","GCSE: 7","GCSE: 6-","A_level: Maths + Further","A_level: Maths","A_level: No Maths"],"group":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","GCSE: 8","GCSE: 7","GCSE: 6-","A_level: Maths + Further","A_level: Maths","A_level: No Maths"]},"options":{"NodeID":"names","NodeGroup":"names","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":0,"sinksRight":false}},"evals":[],"jsHooks":{"render":[{"code":"\n            function(el, x) {\n                d3.selectAll(\".node\").select(\"title foreignObject body pre\")\n                .text(function(d) { return d.state; });\n            }\n            ","data":null},{"code":"\n  function(el, x) {\n  d3.selectAll(\".link\").select(\"title foreignObject body pre\")\n  .text(function(d) { return d.name; });\n  }\n  ","data":null}]}}</script><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Only those that are FSM and got a grade 9 at GCSE.</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="../reference/sankey_filtered.html">sankey_filtered</a></span><span class="op">(</span>pathways <span class="op">=</span> <span class="va">pathways</span>, flow_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'GCSE: 9'</span>, <span class="st">'FSM: Yes'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-5b1b2f4ad92281566982" style="width:960px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-5b1b2f4ad92281566982">{"x":{"links":{"source":[2,3,0,2,3,0,1,2,3,0,1,2,3,0,1,2,3,4,5,6,7,8,9,9,9],"target":[4,4,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,11,12],"value":["2","1","2","4","2","2","7","1","9","7","7","10","12","2","2","2","1","3","8","19","36","7","2","5","66"]},"nodes":{"name":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","A_level: Maths + Further","A_level: Maths","A_level: No Maths"],"group":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","A_level: Maths + Further","A_level: Maths","A_level: No Maths"]},"options":{"NodeID":"names","NodeGroup":"names","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":0,"sinksRight":false}},"evals":[],"jsHooks":{"render":[{"code":"\n            function(el, x) {\n                d3.selectAll(\".node\").select(\"title foreignObject body pre\")\n                .text(function(d) { return d.state; });\n            }\n            ","data":null},{"code":"\n  function(el, x) {\n  d3.selectAll(\".link\").select(\"title foreignObject body pre\")\n  .text(function(d) { return d.name; });\n  }\n  ","data":null}]}}</script><p>If we instead want to ‘trace’ the students of interest within the
whole system we can use the <code><a href="../reference/sankey_trace.html">sankey_trace()</a></code> function, where
instead of ‘filters’ we enter the students we want to trace by the
<code>split_by</code> input.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Only those that have FSM status.</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="../reference/sankey_trace.html">sankey_trace</a></span><span class="op">(</span>pathways <span class="op">=</span> <span class="va">pathways</span>, flow_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, split_by <span class="op">=</span> <span class="st">'FSM: Yes'</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-25c3e940e6859592f801" style="width:960px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-25c3e940e6859592f801">{"x":{"links":{"source":[0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,9,10,11,12,9,10,11,12,9,10,11,12,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,9,10,11,12,9,10,11,12,9,10,11,12],"target":[4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15],"value":["13","23","14","17","64","93","96","80","115","141","158","136","243","288","272","282","68","107","69","68","3","8","19","36","7","4","27","43","83","28","6","46","53","111","38","54","252","435","855","239","2","4","3","46","5","14","29","141","66","167","222","1648","45","60","60","57","253","322","313","273","345","467","503","425","749","954","969","893","196","255","270","244","4","23","45","113","27","16","76","127","279","65","23","129","175","336","101","179","933","1393","2837","772","5","14","11","122","20","50","66","520","187","499","687","5472"],"group":["type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b"],"name":["Flow for students in: FSM: Yes.\nFlow: (KS1: 3+) -> (KS2: 6) = 13 (22.4%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 2A) -> (KS2: 6) = 23 (27.7%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 2B) -> (KS2: 6) = 14 (18.9%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 2C-) -> (KS2: 6) = 17 (23%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 3+) -> (KS2: 5+) = 64 (20.2%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 2A) -> (KS2: 5+) = 93 (22.4%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 2B) -> (KS2: 5+) = 96 (23.5%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 2C-) -> (KS2: 5+) = 80 (22.7%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 3+) -> (KS2: 5-) = 115 (25%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 2A) -> (KS2: 5-) = 141 (23.2%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 2B) -> (KS2: 5-) = 158 (23.9%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 2C-) -> (KS2: 5-) = 136 (24.2%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 3+) -> (KS2: 4) = 243 (24.5%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 2A) -> (KS2: 4) = 288 (23.2%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 2B) -> (KS2: 4) = 272 (21.9%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 2C-) -> (KS2: 4) = 282 (24%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 3+) -> (KS2: 3-) = 68 (25.8%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 2A) -> (KS2: 3-) = 107 (29.6%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 2B) -> (KS2: 3-) = 69 (20.4%)","Flow for students in: FSM: Yes.\nFlow: (KS1: 2C-) -> (KS2: 3-) = 68 (21.8%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 6) -> (GCSE: 9) = 3 (42.9%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 5+) -> (GCSE: 9) = 8 (25.8%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 5-) -> (GCSE: 9) = 19 (29.7%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 4) -> (GCSE: 9) = 36 (24.2%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 3-) -> (GCSE: 9) = 7 (20.6%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 6) -> (GCSE: 8) = 4 (20%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 5+) -> (GCSE: 8) = 27 (26.2%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 5-) -> (GCSE: 8) = 43 (25.3%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 4) -> (GCSE: 8) = 83 (22.9%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 3-) -> (GCSE: 8) = 28 (30.1%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 6) -> (GCSE: 7) = 6 (20.7%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 5+) -> (GCSE: 7) = 46 (26.3%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 5-) -> (GCSE: 7) = 53 (23.2%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 4) -> (GCSE: 7) = 111 (24.8%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 3-) -> (GCSE: 7) = 38 (27.3%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 6) -> (GCSE: 6-) = 54 (23.2%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 5+) -> (GCSE: 6-) = 252 (21.3%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 5-) -> (GCSE: 6-) = 435 (23.8%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 4) -> (GCSE: 6-) = 855 (23.2%)","Flow for students in: FSM: Yes.\nFlow: (KS2: 3-) -> (GCSE: 6-) = 239 (23.6%)","Flow for students in: FSM: Yes.\nFlow: (GCSE: 9) -> (A_level: Maths + Further) = 2 (28.6%)","Flow for students in: FSM: Yes.\nFlow: (GCSE: 8) -> (A_level: Maths + Further) = 4 (22.2%)","Flow for students in: FSM: Yes.\nFlow: (GCSE: 7) -> (A_level: Maths + Further) = 3 (21.4%)","Flow for students in: FSM: Yes.\nFlow: (GCSE: 6-) -> (A_level: Maths + Further) = 46 (27.4%)","Flow for students in: FSM: Yes.\nFlow: (GCSE: 9) -> (A_level: Maths) = 5 (20%)","Flow for students in: FSM: Yes.\nFlow: (GCSE: 8) -> (A_level: Maths) = 14 (21.9%)","Flow for students in: FSM: Yes.\nFlow: (GCSE: 7) -> (A_level: Maths) = 29 (30.5%)","Flow for students in: FSM: Yes.\nFlow: (GCSE: 6-) -> (A_level: Maths) = 141 (21.3%)","Flow for students in: FSM: Yes.\nFlow: (GCSE: 9) -> (A_level: No Maths) = 66 (26.1%)","Flow for students in: FSM: Yes.\nFlow: (GCSE: 8) -> (A_level: No Maths) = 167 (25.1%)","Flow for students in: FSM: Yes.\nFlow: (GCSE: 7) -> (A_level: No Maths) = 222 (24.4%)","Flow for students in: FSM: Yes.\nFlow: (GCSE: 6-) -> (A_level: No Maths) = 1648 (23.1%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 3+) -> (KS2: 6) = 45 (77.6%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 2A) -> (KS2: 6) = 60 (72.3%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 2B) -> (KS2: 6) = 60 (81.1%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 2C-) -> (KS2: 6) = 57 (77%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 3+) -> (KS2: 5+) = 253 (79.8%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 2A) -> (KS2: 5+) = 322 (77.6%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 2B) -> (KS2: 5+) = 313 (76.5%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 2C-) -> (KS2: 5+) = 273 (77.3%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 3+) -> (KS2: 5-) = 345 (75%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 2A) -> (KS2: 5-) = 467 (76.8%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 2B) -> (KS2: 5-) = 503 (76.1%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 2C-) -> (KS2: 5-) = 425 (75.8%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 3+) -> (KS2: 4) = 749 (75.5%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 2A) -> (KS2: 4) = 954 (76.8%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 2B) -> (KS2: 4) = 969 (78.1%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 2C-) -> (KS2: 4) = 893 (76%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 3+) -> (KS2: 3-) = 196 (74.2%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 2A) -> (KS2: 3-) = 255 (70.4%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 2B) -> (KS2: 3-) = 270 (79.6%)","Flow for students not in: FSM: Yes.\nFlow: (KS1: 2C-) -> (KS2: 3-) = 244 (78.2%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 6) -> (GCSE: 9) = 4 (57.1%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 5+) -> (GCSE: 9) = 23 (74.2%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 5-) -> (GCSE: 9) = 45 (70.3%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 4) -> (GCSE: 9) = 113 (75.8%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 3-) -> (GCSE: 9) = 27 (79.4%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 6) -> (GCSE: 8) = 16 (80%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 5+) -> (GCSE: 8) = 76 (73.8%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 5-) -> (GCSE: 8) = 127 (74.7%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 4) -> (GCSE: 8) = 279 (77.1%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 3-) -> (GCSE: 8) = 65 (69.9%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 6) -> (GCSE: 7) = 23 (79.3%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 5+) -> (GCSE: 7) = 129 (73.7%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 5-) -> (GCSE: 7) = 175 (76.8%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 4) -> (GCSE: 7) = 336 (75.2%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 3-) -> (GCSE: 7) = 101 (72.7%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 6) -> (GCSE: 6-) = 179 (76.8%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 5+) -> (GCSE: 6-) = 933 (78.7%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 5-) -> (GCSE: 6-) = 1393 (76.2%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 4) -> (GCSE: 6-) = 2837 (76.8%)","Flow for students not in: FSM: Yes.\nFlow: (KS2: 3-) -> (GCSE: 6-) = 772 (76.4%)","Flow for students not in: FSM: Yes.\nFlow: (GCSE: 9) -> (A_level: Maths + Further) = 5 (71.4%)","Flow for students not in: FSM: Yes.\nFlow: (GCSE: 8) -> (A_level: Maths + Further) = 14 (77.8%)","Flow for students not in: FSM: Yes.\nFlow: (GCSE: 7) -> (A_level: Maths + Further) = 11 (78.6%)","Flow for students not in: FSM: Yes.\nFlow: (GCSE: 6-) -> (A_level: Maths + Further) = 122 (72.6%)","Flow for students not in: FSM: Yes.\nFlow: (GCSE: 9) -> (A_level: Maths) = 20 (80%)","Flow for students not in: FSM: Yes.\nFlow: (GCSE: 8) -> (A_level: Maths) = 50 (78.1%)","Flow for students not in: FSM: Yes.\nFlow: (GCSE: 7) -> (A_level: Maths) = 66 (69.5%)","Flow for students not in: FSM: Yes.\nFlow: (GCSE: 6-) -> (A_level: Maths) = 520 (78.7%)","Flow for students not in: FSM: Yes.\nFlow: (GCSE: 9) -> (A_level: No Maths) = 187 (73.9%)","Flow for students not in: FSM: Yes.\nFlow: (GCSE: 8) -> (A_level: No Maths) = 499 (74.9%)","Flow for students not in: FSM: Yes.\nFlow: (GCSE: 7) -> (A_level: No Maths) = 687 (75.6%)","Flow for students not in: FSM: Yes.\nFlow: (GCSE: 6-) -> (A_level: No Maths) = 5472 (76.9%)"]},"nodes":{"name":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","GCSE: 8","GCSE: 7","GCSE: 6-","A_level: Maths + Further","A_level: Maths","A_level: No Maths"],"group":["my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group"],"state":["KS1: 3+\nTotal students out = 2091.\n\n # students group by FSM: Yes. \n shown as (in : not in) \n\nOut = 503 : 1588.\nPercent = 24.1%.","KS1: 2A\nTotal students out = 2710.\n\n # students group by FSM: Yes. \n shown as (in : not in) \n\nOut = 652 : 2058.\nPercent = 24.1%.","KS1: 2B\nTotal students out = 2724.\n\n # students group by FSM: Yes. \n shown as (in : not in) \n\nOut = 609 : 2115.\nPercent = 22.4%.","KS1: 2C-\nTotal students out = 2475.\n\n # students group by FSM: Yes. \n shown as (in : not in) \n\nOut = 583 : 1892.\nPercent = 23.6%.","KS2: 6\nTotal students in = 289.\nTotal students out = 289.\nContinuation = 100%.\n\n # students group by FSM: Yes. \n shown as (in : not in) \n\nIn = 67 : 222.\nPercent = 23.2%.\nOut = 67 : 222.\nPercent = 23.2%.","KS2: 5+\nTotal students in = 1494.\nTotal students out = 1494.\nContinuation = 100%.\n\n # students group by FSM: Yes. \n shown as (in : not in) \n\nIn = 333 : 1161.\nPercent = 22.3%.\nOut = 333 : 1161.\nPercent = 22.3%.","KS2: 5-\nTotal students in = 2290.\nTotal students out = 2290.\nContinuation = 100%.\n\n # students group by FSM: Yes. \n shown as (in : not in) \n\nIn = 550 : 1740.\nPercent = 24%.\nOut = 550 : 1740.\nPercent = 24%.","KS2: 4\nTotal students in = 4650.\nTotal students out = 4650.\nContinuation = 100%.\n\n # students group by FSM: Yes. \n shown as (in : not in) \n\nIn = 1085 : 3565.\nPercent = 23.3%.\nOut = 1085 : 3565.\nPercent = 23.3%.","KS2: 3-\nTotal students in = 1277.\nTotal students out = 1277.\nContinuation = 100%.\n\n # students group by FSM: Yes. \n shown as (in : not in) \n\nIn = 312 : 965.\nPercent = 24.4%.\nOut = 312 : 965.\nPercent = 24.4%.","GCSE: 9\nTotal students in = 285.\nTotal students out = 285.\nContinuation = 100%.\n\n # students group by FSM: Yes. \n shown as (in : not in) \n\nIn = 73 : 212.\nPercent = 25.6%.\nOut = 73 : 212.\nPercent = 25.6%.","GCSE: 8\nTotal students in = 748.\nTotal students out = 748.\nContinuation = 100%.\n\n # students group by FSM: Yes. \n shown as (in : not in) \n\nIn = 185 : 563.\nPercent = 24.7%.\nOut = 185 : 563.\nPercent = 24.7%.","GCSE: 7\nTotal students in = 1018.\nTotal students out = 1018.\nContinuation = 100%.\n\n # students group by FSM: Yes. \n shown as (in : not in) \n\nIn = 254 : 764.\nPercent = 25%.\nOut = 254 : 764.\nPercent = 25%.","GCSE: 6-\nTotal students in = 7949.\nTotal students out = 7949.\nContinuation = 100%.\n\n # students group by FSM: Yes. \n shown as (in : not in) \n\nIn = 1835 : 6114.\nPercent = 23.1%.\nOut = 1835 : 6114.\nPercent = 23.1%.","A_level: Maths + Further\nTotal students in = 207.\n\n # students group by FSM: Yes. \n shown as (in : not in) \n\nIn = 55 : 152.\nPercent = 26.6%.","A_level: Maths\nTotal students in = 845.\n\n # students group by FSM: Yes. \n shown as (in : not in) \n\nIn = 189 : 656.\nPercent = 22.4%.","A_level: No Maths\nTotal students in = 8948.\n\n # students group by FSM: Yes. \n shown as (in : not in) \n\nIn = 2103 : 6845.\nPercent = 23.5%."]},"options":{"NodeID":"names","NodeGroup":"group","LinkGroup":"group","colourScale":"d3.scaleOrdinal() .domain([\"type_a\", \"type_b\", \"my_unique_group\"]) .range([\"red\", \"gray\", \"antiquewhite\"])","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":0,"sinksRight":false}},"evals":[],"jsHooks":{"render":[{"code":"\n            function(el, x) {\n                d3.selectAll(\".node\").select(\"title foreignObject body pre\")\n                .text(function(d) { return d.state; });\n            }\n            ","data":null},{"code":"\n  function(el, x) {\n  d3.selectAll(\".link\").select(\"title foreignObject body pre\")\n  .text(function(d) { return d.name; });\n  }\n  ","data":null}]}}</script><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Only those that got a grade 9 at GCSE.</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="../reference/sankey_trace.html">sankey_trace</a></span><span class="op">(</span>pathways <span class="op">=</span> <span class="va">pathways</span>, flow_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, split_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'GCSE: 9'</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-3f27c09be0c60bb52829" style="width:960px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-3f27c09be0c60bb52829">{"x":{"links":{"source":[2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,4,5,6,7,8,9,9,9,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,10,11,12,10,11,12,10,11,12],"target":[4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,13,14,15,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,13,13,13,14,14,14,15,15,15],"value":["3","4","5","10","12","4","9","23","9","23","39","43","36","31","6","9","11","8","7","31","64","149","34","7","25","253","58","83","71","70","312","405","397","349","451","585","652","538","953","1199","1205","1144","258","353","328","304","20","103","170","362","93","29","175","228","447","139","233","1185","1828","3692","1011","18","14","168","64","95","661","666","909","7120"],"group":["type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_a","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b","type_b"],"name":["Flow for students in: GCSE: 9.\nFlow: (KS1: 2B) -> (KS2: 6) = 3 (4.1%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 2C-) -> (KS2: 6) = 4 (5.4%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 3+) -> (KS2: 5+) = 5 (1.6%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 2A) -> (KS2: 5+) = 10 (2.4%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 2B) -> (KS2: 5+) = 12 (2.9%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 2C-) -> (KS2: 5+) = 4 (1.1%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 3+) -> (KS2: 5-) = 9 (2%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 2A) -> (KS2: 5-) = 23 (3.8%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 2B) -> (KS2: 5-) = 9 (1.4%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 2C-) -> (KS2: 5-) = 23 (4.1%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 3+) -> (KS2: 4) = 39 (3.9%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 2A) -> (KS2: 4) = 43 (3.5%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 2B) -> (KS2: 4) = 36 (2.9%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 2C-) -> (KS2: 4) = 31 (2.6%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 3+) -> (KS2: 3-) = 6 (2.3%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 2A) -> (KS2: 3-) = 9 (2.5%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 2B) -> (KS2: 3-) = 11 (3.2%)","Flow for students in: GCSE: 9.\nFlow: (KS1: 2C-) -> (KS2: 3-) = 8 (2.6%)","Flow for students in: GCSE: 9.\nFlow: (KS2: 6) -> (GCSE: 9) = 7 (100%)","Flow for students in: GCSE: 9.\nFlow: (KS2: 5+) -> (GCSE: 9) = 31 (100%)","Flow for students in: GCSE: 9.\nFlow: (KS2: 5-) -> (GCSE: 9) = 64 (100%)","Flow for students in: GCSE: 9.\nFlow: (KS2: 4) -> (GCSE: 9) = 149 (100%)","Flow for students in: GCSE: 9.\nFlow: (KS2: 3-) -> (GCSE: 9) = 34 (100%)","Flow for students in: GCSE: 9.\nFlow: (GCSE: 9) -> (A_level: Maths + Further) = 7 (100%)","Flow for students in: GCSE: 9.\nFlow: (GCSE: 9) -> (A_level: Maths) = 25 (100%)","Flow for students in: GCSE: 9.\nFlow: (GCSE: 9) -> (A_level: No Maths) = 253 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 3+) -> (KS2: 6) = 58 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 2A) -> (KS2: 6) = 83 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 2B) -> (KS2: 6) = 71 (95.9%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 2C-) -> (KS2: 6) = 70 (94.6%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 3+) -> (KS2: 5+) = 312 (98.4%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 2A) -> (KS2: 5+) = 405 (97.6%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 2B) -> (KS2: 5+) = 397 (97.1%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 2C-) -> (KS2: 5+) = 349 (98.9%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 3+) -> (KS2: 5-) = 451 (98%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 2A) -> (KS2: 5-) = 585 (96.2%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 2B) -> (KS2: 5-) = 652 (98.6%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 2C-) -> (KS2: 5-) = 538 (95.9%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 3+) -> (KS2: 4) = 953 (96.1%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 2A) -> (KS2: 4) = 1199 (96.5%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 2B) -> (KS2: 4) = 1205 (97.1%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 2C-) -> (KS2: 4) = 1144 (97.4%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 3+) -> (KS2: 3-) = 258 (97.7%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 2A) -> (KS2: 3-) = 353 (97.5%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 2B) -> (KS2: 3-) = 328 (96.8%)","Flow for students not in: GCSE: 9.\nFlow: (KS1: 2C-) -> (KS2: 3-) = 304 (97.4%)","Flow for students not in: GCSE: 9.\nFlow: (KS2: 6) -> (GCSE: 8) = 20 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS2: 5+) -> (GCSE: 8) = 103 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS2: 5-) -> (GCSE: 8) = 170 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS2: 4) -> (GCSE: 8) = 362 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS2: 3-) -> (GCSE: 8) = 93 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS2: 6) -> (GCSE: 7) = 29 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS2: 5+) -> (GCSE: 7) = 175 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS2: 5-) -> (GCSE: 7) = 228 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS2: 4) -> (GCSE: 7) = 447 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS2: 3-) -> (GCSE: 7) = 139 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS2: 6) -> (GCSE: 6-) = 233 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS2: 5+) -> (GCSE: 6-) = 1185 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS2: 5-) -> (GCSE: 6-) = 1828 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS2: 4) -> (GCSE: 6-) = 3692 (100%)","Flow for students not in: GCSE: 9.\nFlow: (KS2: 3-) -> (GCSE: 6-) = 1011 (100%)","Flow for students not in: GCSE: 9.\nFlow: (GCSE: 8) -> (A_level: Maths + Further) = 18 (100%)","Flow for students not in: GCSE: 9.\nFlow: (GCSE: 7) -> (A_level: Maths + Further) = 14 (100%)","Flow for students not in: GCSE: 9.\nFlow: (GCSE: 6-) -> (A_level: Maths + Further) = 168 (100%)","Flow for students not in: GCSE: 9.\nFlow: (GCSE: 8) -> (A_level: Maths) = 64 (100%)","Flow for students not in: GCSE: 9.\nFlow: (GCSE: 7) -> (A_level: Maths) = 95 (100%)","Flow for students not in: GCSE: 9.\nFlow: (GCSE: 6-) -> (A_level: Maths) = 661 (100%)","Flow for students not in: GCSE: 9.\nFlow: (GCSE: 8) -> (A_level: No Maths) = 666 (100%)","Flow for students not in: GCSE: 9.\nFlow: (GCSE: 7) -> (A_level: No Maths) = 909 (100%)","Flow for students not in: GCSE: 9.\nFlow: (GCSE: 6-) -> (A_level: No Maths) = 7120 (100%)"]},"nodes":{"name":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","GCSE: 8","GCSE: 7","GCSE: 6-","A_level: Maths + Further","A_level: Maths","A_level: No Maths"],"group":["my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group","my_unique_group"],"state":["KS1: 3+\nTotal students out = 2091.\n\n # students group by GCSE: 9. \n shown as (in : not in) \n\nOut = 59 : 2032.\nPercent = 2.8%.","KS1: 2A\nTotal students out = 2710.\n\n # students group by GCSE: 9. \n shown as (in : not in) \n\nOut = 85 : 2625.\nPercent = 3.1%.","KS1: 2B\nTotal students out = 2724.\n\n # students group by GCSE: 9. \n shown as (in : not in) \n\nOut = 71 : 2653.\nPercent = 2.6%.","KS1: 2C-\nTotal students out = 2475.\n\n # students group by GCSE: 9. \n shown as (in : not in) \n\nOut = 70 : 2405.\nPercent = 2.8%.","KS2: 6\nTotal students in = 289.\nTotal students out = 289.\nContinuation = 100%.\n\n # students group by GCSE: 9. \n shown as (in : not in) \n\nIn = 7 : 282.\nPercent = 2.4%.\nOut = 7 : 282.\nPercent = 2.4%.","KS2: 5+\nTotal students in = 1494.\nTotal students out = 1494.\nContinuation = 100%.\n\n # students group by GCSE: 9. \n shown as (in : not in) \n\nIn = 31 : 1463.\nPercent = 2.1%.\nOut = 31 : 1463.\nPercent = 2.1%.","KS2: 5-\nTotal students in = 2290.\nTotal students out = 2290.\nContinuation = 100%.\n\n # students group by GCSE: 9. \n shown as (in : not in) \n\nIn = 64 : 2226.\nPercent = 2.8%.\nOut = 64 : 2226.\nPercent = 2.8%.","KS2: 4\nTotal students in = 4650.\nTotal students out = 4650.\nContinuation = 100%.\n\n # students group by GCSE: 9. \n shown as (in : not in) \n\nIn = 149 : 4501.\nPercent = 3.2%.\nOut = 149 : 4501.\nPercent = 3.2%.","KS2: 3-\nTotal students in = 1277.\nTotal students out = 1277.\nContinuation = 100%.\n\n # students group by GCSE: 9. \n shown as (in : not in) \n\nIn = 34 : 1243.\nPercent = 2.7%.\nOut = 34 : 1243.\nPercent = 2.7%.","GCSE: 9\nTotal students in = 285.\nTotal students out = 285.\nContinuation = 100%.\n\n # students group by GCSE: 9. \n shown as (in : not in) \n\nIn = 285 : 0.\nPercent = 100%.\nOut = 285 : 0.\nPercent = 100%.","GCSE: 8\nTotal students in = 748.\nTotal students out = 748.\nContinuation = 100%.\n\n # students group by GCSE: 9. \n shown as (in : not in) \n","GCSE: 7\nTotal students in = 1018.\nTotal students out = 1018.\nContinuation = 100%.\n\n # students group by GCSE: 9. \n shown as (in : not in) \n","GCSE: 6-\nTotal students in = 7949.\nTotal students out = 7949.\nContinuation = 100%.\n\n # students group by GCSE: 9. \n shown as (in : not in) \n","A_level: Maths + Further\nTotal students in = 207.\n\n # students group by GCSE: 9. \n shown as (in : not in) \n\nIn = 7 : 200.\nPercent = 3.4%.","A_level: Maths\nTotal students in = 845.\n\n # students group by GCSE: 9. \n shown as (in : not in) \n\nIn = 25 : 820.\nPercent = 3%.","A_level: No Maths\nTotal students in = 8948.\n\n # students group by GCSE: 9. \n shown as (in : not in) \n\nIn = 253 : 8695.\nPercent = 2.8%."]},"options":{"NodeID":"names","NodeGroup":"group","LinkGroup":"group","colourScale":"d3.scaleOrdinal() .domain([\"type_a\", \"type_b\", \"my_unique_group\"]) .range([\"red\", \"gray\", \"antiquewhite\"])","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":0,"sinksRight":false}},"evals":[],"jsHooks":{"render":[{"code":"\n            function(el, x) {\n                d3.selectAll(\".node\").select(\"title foreignObject body pre\")\n                .text(function(d) { return d.state; });\n            }\n            ","data":null},{"code":"\n  function(el, x) {\n  d3.selectAll(\".link\").select(\"title foreignObject body pre\")\n  .text(function(d) { return d.name; });\n  }\n  ","data":null}]}}</script><p>Finally we can also split the sankey flows by a particular
demographic or characteristic, to do this we can use
<code><a href="../reference/sankey_trace_groups.html">sankey_trace_groups()</a></code> where we specify a column that we
want to split the flows by.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Only those that have FSM status.</span></span>
<span><span class="va">p_grouped</span> <span class="op">=</span>  <span class="fu"><a href="../reference/sankey_trace_groups.html">sankey_trace_groups</a></span><span class="op">(</span>pathways <span class="op">=</span> <span class="va">pathways</span>, flow_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, group_column <span class="op">=</span> <span class="st">'IDACI'</span>,colors <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p_grouped</span></span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-416566eb193bf50d04e6" style="width:960px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-416566eb193bf50d04e6">{"x":{"links":{"source":[0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,9,10,11,12,9,10,11,12,9,10,11,12,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,5,6,7,8,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,9,10,11,12,9,10,11,12,9,10,11,12,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,9,10,11,12,9,10,11,12,9,10,11,12,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,10,11,12,9,10,11,12,9,10,11,12,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,5,6,7,8,4,5,6,7,8,4,5,6,7,8,4,5,6,7,8,9,10,11,12,9,10,11,12,9,10,11,12],"target":[4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,13,13,13,14,14,14,14,15,15,15,15,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15],"value":["10","25","10","20","66","93","76","74","97","98","130","122","194","233","266","248","54","83","77","51","3","4","11","27","11","2","25","41","78","20","3","34","40","94","26","57","246","355","742","208","1","3","6","41","11","13","23","136","44","150","168","1431","15","12","17","11","63","78","73","68","99","134","122","105","199","246","262","241","53","69","65","67","6","15","32","5","4","27","29","74","20","4","33","34","78","26","47","216","382","764","203","2","3","3","25","4","17","16","127","52","134","156","1460","7","15","22","11","58","95","78","58","90","124","142","118","183","239","235","217","61","79","60","63","1","8","11","30","6","7","15","28","63","17","4","41","46","88","33","43","225","389","693","207","2","4","2","45","4","7","24","124","50","119","186","1388","12","14","17","18","56","73","77","74","83","129","136","102","215","247","242","228","46","71","63","69","3","5","13","32","6","5","17","38","74","12","10","29","49","100","28","43","229","350","726","203","4","2","22","2","16","14","145","57","126","200","1384","14","17","8","14","74","76","105","79","91","123","131","114","201","277","236","241","50","60","74","62","8","14","28","6","2","19","34","73","24","8","38","59","87","26","43","269","352","767","190","2","4","1","35","4","11","18","129","50","137","199","1457"],"name":["IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 1st \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 2nd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 3rd \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 4th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n","IDACI = 5th \n\n"],"group":["link_1","link_2","link_3","link_4","link_5","link_6","link_7","link_8","link_9","link_10","link_11","link_12","link_13","link_14","link_15","link_16","link_17","link_18","link_19","link_20","link_21","link_22","link_23","link_24","link_25","link_26","link_27","link_28","link_29","link_30","link_31","link_32","link_33","link_34","link_35","link_36","link_37","link_38","link_39","link_40","link_41","link_42","link_43","link_44","link_45","link_46","link_47","link_48","link_49","link_50","link_51","link_52","link_53","link_54","link_55","link_56","link_57","link_58","link_59","link_60","link_61","link_62","link_63","link_64","link_65","link_66","link_67","link_68","link_69","link_70","link_71","link_72","link_73","link_74","link_75","link_76","link_77","link_78","link_79","link_80","link_81","link_82","link_83","link_84","link_85","link_86","link_87","link_88","link_89","link_90","link_91","link_92","link_93","link_94","link_95","link_96","link_97","link_98","link_99","link_100","link_101","link_102","link_103","link_104","link_105","link_106","link_107","link_108","link_109","link_110","link_111","link_112","link_113","link_114","link_115","link_116","link_117","link_118","link_119","link_120","link_121","link_122","link_123","link_124","link_125","link_126","link_127","link_128","link_129","link_130","link_131","link_132","link_133","link_134","link_135","link_136","link_137","link_138","link_139","link_140","link_141","link_142","link_143","link_144","link_145","link_146","link_147","link_148","link_149","link_150","link_151","link_152","link_153","link_154","link_155","link_156","link_157","link_158","link_159","link_160","link_161","link_162","link_163","link_164","link_165","link_166","link_167","link_168","link_169","link_170","link_171","link_172","link_173","link_174","link_175","link_176","link_177","link_178","link_179","link_180","link_181","link_182","link_183","link_184","link_185","link_186","link_187","link_188","link_189","link_190","link_191","link_192","link_193","link_194","link_195","link_196","link_197","link_198","link_199","link_200","link_201","link_202","link_203","link_204","link_205","link_206","link_207","link_208","link_209","link_210","link_211","link_212","link_213","link_214","link_215","link_216","link_217","link_218","link_219","link_220","link_221","link_222","link_223","link_224","link_225","link_226","link_227","link_228","link_229","link_230","link_231","link_232","link_233","link_234","link_235","link_236","link_237","link_238","link_239","link_240","link_241","link_242","link_243","link_244","link_245","link_246","link_247","link_248","link_249","link_250","link_251","link_252","link_253","link_254","link_255","link_256","link_257"],"colouring":["#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#440154FF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#3B528BFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#21908CFF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#5DC863FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF","#FDE725FF"]},"nodes":{"name":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","GCSE: 8","GCSE: 7","GCSE: 6-","A_level: Maths + Further","A_level: Maths","A_level: No Maths"],"group":["node_1","node_2","node_3","node_4","node_5","node_6","node_7","node_8","node_9","node_10","node_11","node_12","node_13","node_14","node_15","node_16"],"colouring":["gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray"]},"options":{"NodeID":"names","NodeGroup":"names","LinkGroup":null,"colourScale":"d3.scaleOrdinal() .domain([ \"node_1\", \"node_2\", \"node_3\", \"node_4\", \"node_5\", \"node_6\", \"node_7\", \"node_8\", \"node_9\", \"node_10\", \"node_11\", \"node_12\", \"node_13\", \"node_14\", \"node_15\", \"node_16\", \"link_1\", \"link_2\", \"link_3\", \"link_4\", \"link_5\", \"link_6\", \"link_7\", \"link_8\", \"link_9\", \"link_10\", \"link_11\", \"link_12\", \"link_13\", \"link_14\", \"link_15\", \"link_16\", \"link_17\", \"link_18\", \"link_19\", \"link_20\", \"link_21\", \"link_22\", \"link_23\", \"link_24\", \"link_25\", \"link_26\", \"link_27\", \"link_28\", \"link_29\", \"link_30\", \"link_31\", \"link_32\", \"link_33\", \"link_34\", \"link_35\", \"link_36\", \"link_37\", \"link_38\", \"link_39\", \"link_40\", \"link_41\", \"link_42\", \"link_43\", \"link_44\", \"link_45\", \"link_46\", \"link_47\", \"link_48\", \"link_49\", \"link_50\", \"link_51\", \"link_52\", \"link_53\", \"link_54\", \"link_55\", \"link_56\", \"link_57\", \"link_58\", \"link_59\", \"link_60\", \"link_61\", \"link_62\", \"link_63\", \"link_64\", \"link_65\", \"link_66\", \"link_67\", \"link_68\", \"link_69\", \"link_70\", \"link_71\", \"link_72\", \"link_73\", \"link_74\", \"link_75\", \"link_76\", \"link_77\", \"link_78\", \"link_79\", \"link_80\", \"link_81\", \"link_82\", \"link_83\", \"link_84\", \"link_85\", \"link_86\", \"link_87\", \"link_88\", \"link_89\", \"link_90\", \"link_91\", \"link_92\", \"link_93\", \"link_94\", \"link_95\", \"link_96\", \"link_97\", \"link_98\", \"link_99\", \"link_100\", \"link_101\", \"link_102\", \"link_103\", \"link_104\", \"link_105\", \"link_106\", \"link_107\", \"link_108\", \"link_109\", \"link_110\", \"link_111\", \"link_112\", \"link_113\", \"link_114\", \"link_115\", \"link_116\", \"link_117\", \"link_118\", \"link_119\", \"link_120\", \"link_121\", \"link_122\", \"link_123\", \"link_124\", \"link_125\", \"link_126\", \"link_127\", \"link_128\", \"link_129\", \"link_130\", \"link_131\", \"link_132\", \"link_133\", \"link_134\", \"link_135\", \"link_136\", \"link_137\", \"link_138\", \"link_139\", \"link_140\", \"link_141\", \"link_142\", \"link_143\", \"link_144\", \"link_145\", \"link_146\", \"link_147\", \"link_148\", \"link_149\", \"link_150\", \"link_151\", \"link_152\", \"link_153\", \"link_154\", \"link_155\", \"link_156\", \"link_157\", \"link_158\", \"link_159\", \"link_160\", \"link_161\", \"link_162\", \"link_163\", \"link_164\", \"link_165\", \"link_166\", \"link_167\", \"link_168\", \"link_169\", \"link_170\", \"link_171\", \"link_172\", \"link_173\", \"link_174\", \"link_175\", \"link_176\", \"link_177\", \"link_178\", \"link_179\", \"link_180\", \"link_181\", \"link_182\", \"link_183\", \"link_184\", \"link_185\", \"link_186\", \"link_187\", \"link_188\", \"link_189\", \"link_190\", \"link_191\", \"link_192\", \"link_193\", \"link_194\", \"link_195\", \"link_196\", \"link_197\", \"link_198\", \"link_199\", \"link_200\", \"link_201\", \"link_202\", \"link_203\", \"link_204\", \"link_205\", \"link_206\", \"link_207\", \"link_208\", \"link_209\", \"link_210\", \"link_211\", \"link_212\", \"link_213\", \"link_214\", \"link_215\", \"link_216\", \"link_217\", \"link_218\", \"link_219\", \"link_220\", \"link_221\", \"link_222\", \"link_223\", \"link_224\", \"link_225\", \"link_226\", \"link_227\", \"link_228\", \"link_229\", \"link_230\", \"link_231\", \"link_232\", \"link_233\", \"link_234\", \"link_235\", \"link_236\", \"link_237\", \"link_238\", \"link_239\", \"link_240\", \"link_241\", \"link_242\", \"link_243\", \"link_244\", \"link_245\", \"link_246\", \"link_247\", \"link_248\", \"link_249\", \"link_250\", \"link_251\", \"link_252\", \"link_253\", \"link_254\", \"link_255\", \"link_256\", \"link_257\" ]) .range([ \"gray\", \"gray\", \"gray\", \"gray\", \"gray\", \"gray\", \"gray\", \"gray\", \"gray\", \"gray\", \"gray\", \"gray\", \"gray\", \"gray\", \"gray\", \"gray\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#440154FF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#3B528BFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#21908CFF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#5DC863FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\", \"#FDE725FF\" ])","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":0,"sinksRight":false}},"evals":[],"jsHooks":{"render":[{"code":"\n  function(el, x) {\n  d3.selectAll(\".link\").select(\"title foreignObject body pre\")\n  .text(function(d) { return d.name; });\n  }\n  ","data":null},{"code":"","data":null}]}}</script>
</div>
<div class="section level3">
<h3 id="customisation-visualisation-options">Customisation visualisation options<a class="anchor" aria-label="anchor" href="#customisation-visualisation-options"></a>
</h3>
<p>In this section we show how to use functions to alter the
visualisation of the sankey diagrams.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="../reference/sankey_filtered.html">sankey_filtered</a></span><span class="op">(</span>pathways <span class="op">=</span> <span class="va">pathways</span>, flow_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'GCSE: 9'</span>, <span class="st">'GCSE: 8'</span><span class="op">)</span>, union <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Add header to columns</span></span>
<span><span class="va">p</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/add_column_names.html">add_column_names</a></span><span class="op">(</span>titles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'KS1'</span>, <span class="st">'KS2'</span>, <span class="st">'GCSE'</span>, <span class="st">'A Level'</span><span class="op">)</span>,fontSize <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-72cbf064100ce560a04c" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-72cbf064100ce560a04c">{"x":{"links":{"source":[0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,4,5,6,7,8,4,5,6,7,8,9,10,9,10,9,10],"target":[4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,12,12,13,13],"value":["4","2","11","10","20","44","43","27","45","70","58","61","114","134","132","131","27","37","38","25","7","31","64","149","34","20","103","170","362","93","7","18","25","64","253","666"]},"nodes":{"name":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","GCSE: 8","A_level: Maths + Further","A_level: Maths","A_level: No Maths"],"group":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","GCSE: 8","A_level: Maths + Further","A_level: Maths","A_level: No Maths"]},"options":{"NodeID":"names","NodeGroup":"names","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":0,"sinksRight":false}},"evals":[],"jsHooks":{"render":[{"code":"\n            function(el, x) {\n                d3.selectAll(\".node\").select(\"title foreignObject body pre\")\n                .text(function(d) { return d.state; });\n            }\n            ","data":null},{"code":"\n  function(el, x) {\n  d3.selectAll(\".link\").select(\"title foreignObject body pre\")\n  .text(function(d) { return d.name; });\n  }\n  ","data":null},{"code":"\n  function(el) {\n    var cols_x = this.sankey.nodes().map(d => d.x).filter((v, i, a) => a.indexOf(v) === i).sort(function(a, b){return a - b});\n    var labels = [\"KS1\", \"KS2\", \"GCSE\", \"A Level\"];\n    cols_x.forEach((d, i) => {\n      d3.select(el).select(\"svg\")\n        .append(\"text\")\n        .attr(\"x\", d)\n        .attr(\"y\", 12)\n        .text(labels[i])\n        .style(\"font-size\", \"14px\")\n        .style(\"font-family\", \"\");\n    })\n  }\n","data":null}]}}</script><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Update the node names.</span></span>
<span><span class="co"># p |&gt; get_nodes() # Can be run to get the node order in the diagram to change.</span></span>
<span><span class="va">p</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/add_column_names.html">update_node_labels</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Level 3+"</span>, <span class="st">"Level 2A"</span>, <span class="st">"Level 2B"</span>, <span class="st">"Level 2C-"</span>,</span>
<span>                       <span class="st">"Level 6"</span>, <span class="st">"Level 5+"</span>, <span class="st">"Level 5-"</span>, <span class="st">"Level 4"</span>, <span class="st">"Level 3-"</span>,</span>
<span>                       <span class="st">"Grade 8"</span>,<span class="st">"Grade 9"</span>,</span>
<span>                       <span class="st">"Maths + Further"</span>, <span class="st">"Maths"</span>, <span class="st">"No Maths"</span> <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-d11fc4360aa0230696d7" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-d11fc4360aa0230696d7">{"x":{"links":{"source":[0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,4,5,6,7,8,4,5,6,7,8,9,10,9,10,9,10],"target":[4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,12,12,13,13],"value":["4","2","11","10","20","44","43","27","45","70","58","61","114","134","132","131","27","37","38","25","7","31","64","149","34","20","103","170","362","93","7","18","25","64","253","666"]},"nodes":{"name":["Level 3+","Level 2A","Level 2B","Level 2C-","Level 6","Level 5+","Level 5-","Level 4","Level 3-","Grade 8","Grade 9","Maths + Further","Maths","No Maths"],"group":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","GCSE: 8","A_level: Maths + Further","A_level: Maths","A_level: No Maths"]},"options":{"NodeID":"names","NodeGroup":"names","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":0,"sinksRight":false}},"evals":[],"jsHooks":{"render":[{"code":"\n            function(el, x) {\n                d3.selectAll(\".node\").select(\"title foreignObject body pre\")\n                .text(function(d) { return d.state; });\n            }\n            ","data":null},{"code":"\n  function(el, x) {\n  d3.selectAll(\".link\").select(\"title foreignObject body pre\")\n  .text(function(d) { return d.name; });\n  }\n  ","data":null},{"code":"","data":null}]}}</script><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Change the colour scheme where the links correspond to the node values (doesn't show in Rmarkdown)</span></span>
<span><span class="va">p</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/add_column_names.html">update_sankey_colour</a></span><span class="op">(</span>colors_node <span class="op">=</span>  <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">magma</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">p</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/get_nodes.html">get_nodes</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          type <span class="op">=</span> <span class="st">'source'</span><span class="op">)</span> </span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-21c7483268bafca56cec" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-21c7483268bafca56cec">{"x":{"links":{"source":[0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,4,5,6,7,8,4,5,6,7,8,9,10,9,10,9,10],"target":[4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,12,12,13,13],"value":["4","2","11","10","20","44","43","27","45","70","58","61","114","134","132","131","27","37","38","25","7","31","64","149","34","20","103","170","362","93","7","18","25","64","253","666"],"group":["link_1","link_2","link_3","link_4","link_5","link_6","link_7","link_8","link_9","link_10","link_11","link_12","link_13","link_14","link_15","link_16","link_17","link_18","link_19","link_20","link_21","link_22","link_23","link_24","link_25","link_26","link_27","link_28","link_29","link_30","link_31","link_32","link_33","link_34","link_35","link_36"],"colouring":["#000004FF","#0D0B2AFF","#281259FF","#491078FF","#000004FF","#0D0B2AFF","#281259FF","#491078FF","#000004FF","#0D0B2AFF","#281259FF","#491078FF","#000004FF","#0D0B2AFF","#281259FF","#491078FF","#000004FF","#0D0B2AFF","#281259FF","#491078FF","#671C80FF","#862781FF","#A6317DFF","#C63C74FF","#E34E65FF","#671C80FF","#862781FF","#A6317DFF","#C63C74FF","#E34E65FF","#F66C5CFF","#FC9065FF","#F66C5CFF","#FC9065FF","#F66C5CFF","#FC9065FF"]},"nodes":{"name":["KS1: 3+","KS1: 2A","KS1: 2B","KS1: 2C-","KS2: 6","KS2: 5+","KS2: 5-","KS2: 4","KS2: 3-","GCSE: 9","GCSE: 8","A_level: Maths + Further","A_level: Maths","A_level: No Maths"],"group":["node_1","node_2","node_3","node_4","node_5","node_6","node_7","node_8","node_9","node_10","node_11","node_12","node_13","node_14"],"colouring":["#000004FF","#0D0B2AFF","#281259FF","#491078FF","#671C80FF","#862781FF","#A6317DFF","#C63C74FF","#E34E65FF","#F66C5CFF","#FC9065FF","#FEB67CFF","#FED99BFF","#FCFDBFFF"]},"options":{"NodeID":"names","NodeGroup":"names","LinkGroup":null,"colourScale":"d3.scaleOrdinal() .domain([ \"node_1\", \"node_2\", \"node_3\", \"node_4\", \"node_5\", \"node_6\", \"node_7\", \"node_8\", \"node_9\", \"node_10\", \"node_11\", \"node_12\", \"node_13\", \"node_14\", \"link_1\", \"link_2\", \"link_3\", \"link_4\", \"link_5\", \"link_6\", \"link_7\", \"link_8\", \"link_9\", \"link_10\", \"link_11\", \"link_12\", \"link_13\", \"link_14\", \"link_15\", \"link_16\", \"link_17\", \"link_18\", \"link_19\", \"link_20\", \"link_21\", \"link_22\", \"link_23\", \"link_24\", \"link_25\", \"link_26\", \"link_27\", \"link_28\", \"link_29\", \"link_30\", \"link_31\", \"link_32\", \"link_33\", \"link_34\", \"link_35\", \"link_36\" ]) .range([ \"#000004FF\", \"#0D0B2AFF\", \"#281259FF\", \"#491078FF\", \"#671C80FF\", \"#862781FF\", \"#A6317DFF\", \"#C63C74FF\", \"#E34E65FF\", \"#F66C5CFF\", \"#FC9065FF\", \"#FEB67CFF\", \"#FED99BFF\", \"#FCFDBFFF\", \"#000004FF\", \"#0D0B2AFF\", \"#281259FF\", \"#491078FF\", \"#000004FF\", \"#0D0B2AFF\", \"#281259FF\", \"#491078FF\", \"#000004FF\", \"#0D0B2AFF\", \"#281259FF\", \"#491078FF\", \"#000004FF\", \"#0D0B2AFF\", \"#281259FF\", \"#491078FF\", \"#000004FF\", \"#0D0B2AFF\", \"#281259FF\", \"#491078FF\", \"#671C80FF\", \"#862781FF\", \"#A6317DFF\", \"#C63C74FF\", \"#E34E65FF\", \"#671C80FF\", \"#862781FF\", \"#A6317DFF\", \"#C63C74FF\", \"#E34E65FF\", \"#F66C5CFF\", \"#FC9065FF\", \"#F66C5CFF\", \"#FC9065FF\", \"#F66C5CFF\", \"#FC9065FF\" ])","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":0,"sinksRight":false}},"evals":[],"jsHooks":{"render":[{"code":"\n            function(el, x) {\n                d3.selectAll(\".node\").select(\"title foreignObject body pre\")\n                .text(function(d) { return d.state; });\n            }\n            ","data":null},{"code":"\n  function(el, x) {\n  d3.selectAll(\".link\").select(\"title foreignObject body pre\")\n  .text(function(d) { return d.name; });\n  }\n  ","data":null},{"code":"","data":null}]}}</script><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="co"># Change the colour for only specified links. (doesn't show in Rmarkdown)</span></span>
<span><span class="va">col</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'gray'</span>, <span class="va">p</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/get_nodes.html">get_links</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">col</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">'orange'</span></span>
<span><span class="va">col</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">25</span>,<span class="fl">20</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">'green'</span>  </span>
<span></span>
<span><span class="va">q</span> <span class="op">=</span> <span class="va">p</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/add_column_names.html">update_sankey_colour</a></span><span class="op">(</span>colors_node <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">magma</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">p</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/get_nodes.html">get_nodes</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                colors_link <span class="op">=</span> <span class="va">col</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="saving-exporting-sankey-diagrams">Saving / exporting sankey diagrams<a class="anchor" aria-label="anchor" href="#saving-exporting-sankey-diagrams"></a>
</h3>
<p>We can use the <code>saveNetwork()</code> from the NetworkD3 package
to save the widget into an .html file or we can use the webshot()
function from the webshot2 package to save a static version of the plot
to a .png file (by taking an image from a saved .html version.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save the interactive sankey diagram</span></span>
<span><span class="fu">networkD3</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/networkD3/man/saveNetwork.html" class="external-link">saveNetwork</a></span><span class="op">(</span>network <span class="op">=</span> <span class="va">p</span>,</span>
<span>                       file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'sankey_diagram.html'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save a static version of the plot (need to save an interactive version first)</span></span>
<span><span class="fu">webshot2</span><span class="fu">::</span><span class="fu">webshot</span><span class="op">(</span>url <span class="op">=</span> <span class="st">'sankey_diagram.html'</span>,</span>
<span>                  file <span class="op">=</span>  <span class="st">'sankey_diagram.png'</span>,</span>
<span>                  vwidth <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                  vheight <span class="op">=</span> <span class="fl">700</span><span class="op">)</span></span></code></pre></div>
<p>Or to save the underlying information in the sankey diagram to
formatted .xlsx file you can use the function
<code><a href="../reference/sankey_export_xlsx.html">sankey_export_xlsx()</a></code>, which allows a title and source to be
added to the spreadsheet (needed for statistical disclosure). This
method creates a spreadsheet with the columns ‘Source’, ‘Target’ and
‘Number of Students’ describing the flow between all nodes in the
diagram. If we are saving a filtered sankey diagram another column will
be added informing whether the flow relates to the traced or non-traced
students.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># Save an .xlsx file containing the sankey information (for SDC check)</span></span>
<span>  <span class="va">p</span> <span class="op">|&gt;</span> <span class="fu">LStools</span><span class="fu">::</span><span class="fu"><a href="../reference/sankey_export_xlsx.html">sankey_export_xlsx</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Student flow from KS1 to A-level choices'</span>,</span>
<span>                              source <span class="op">=</span> <span class="st">'Source: National Pupil Database'</span>,</span>
<span>                              filepath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'/sankey_information.xlsx'</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>    <span class="co"># Save an .xlsx file containing the sankey information traced version</span></span>
<span>    <span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="../reference/sankey_trace.html">sankey_trace</a></span><span class="op">(</span>pathways <span class="op">=</span> <span class="va">pathways</span>,</span>
<span>                     flow_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>,</span>
<span>                     split_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'GCSE: 9'</span>,<span class="st">'GCSE: 8'</span> <span class="op">)</span>,</span>
<span>                     union <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> </span>
<span>    <span class="va">p</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">LStools</span><span class="fu">::</span><span class="fu"><a href="../reference/sankey_export_xlsx.html">sankey_export_xlsx</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Student flow from KS1 to A-level choices tracing those that achieve grade 8 or 9 at GCSE'</span>,</span>
<span>                              source <span class="op">=</span> <span class="st">'Source: National Pupil Database'</span>,</span>
<span>                              filepath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'/sankey_information2.xlsx'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>You can recreate the sankey diagrams (or return a list of nodes and
links required for sankey diagrams) from the exported .xlsx files by
using the <code><a href="../reference/sankey_from_extract.html">sankey_from_extract()</a></code> ( or
<code><a href="../reference/links_from_extract.html">links_from_extract()</a></code>).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jake Powell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
